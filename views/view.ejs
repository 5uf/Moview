<%- include('layouts/header.ejs') %>
<style>
   .container {
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 1rem;
      margin: 0 10rem 0 10rem;
    }
    .container img {
      width: 30rem;
      aspect-ratio: 1/1;
      object-fit: contain;
      mix-blend-mode: color-burn;
    }
    .container .info {
      background-color: #dbf8ef;
      padding: 1rem;
      border-radius: 20px;
      margin: 1rem;
      width: 60%;
      font-size: 1.5rem;
      color: rgb(15, 15, 15);
   }
    .info h1 {
      font-size: 1.5rem;
        margin-bottom: 1rem;
    }
    .info p {
      font-size: 1rem;
        margin-bottom: 1rem;
    }
    .container2 {
       display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .container2 .plot {
      background-color: #3affc4;
      padding: 1rem;
      border-radius: 20px;
      margin: 1rem;
      width: 80%;
      font-size: 1.5rem;
      color: rgb(15, 15, 15);

    }
    .info2 {
      background-color: #dbf8ef;
      padding: 1rem;
      border-radius: 20px;
      margin: 1rem;
      width: 80%;
      font-size: 1.5rem;
      color: rgb(15, 15, 15);
      display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-gap: 1rem;
        margin: 0 10rem 0 10rem;

    }
    .info2 * {
      margin: 0;
      flex: 1;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color:rgb(15, 15, 15);
      
    }
 .btn {
  font-size: 0.7rem;
  padding: 1rem 2.5rem;
  margin: 0.3rem 0 3rem 0;
  border: none;
  outline: none;
  border-radius: 0.4rem;
  cursor: pointer;
  text-transform: uppercase;
  background-color: rgb(255, 255, 255);
  color: rgb(15, 15, 15);
  font-weight: 700;
  transition: 0.6s;
  box-shadow: 0px 0px 60px #651f1f;
  -webkit-box-reflect: below 10px linear-gradient(to bottom, rgba(0,0,0,0.0), rgba(0,0,0,0.4));
}

.btn:active {
  scale: 0.92;
}

.btn:hover {
  background: rgb(225, 240, 18);
  background: linear-gradient(270deg, rgba(243, 255, 75, 0.681) 0%, rgba(232, 229, 31, 0.873) 60%);
  color: rgb(38, 37, 4);
}
.btn svg {
  width: 1.9rem;
  height: 1.5rem;
  margin-left: 0.5rem;
  vertical-align: middle;
}


.rating-container{
    display: grid;
    place-items: center;
    margin-top: 3rem;
    width: 100%;
}
.rating-container .submit{
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    border: none;
    outline: none;
    border-radius: 0.4rem;
    cursor: pointer;
    text-transform: uppercase;
    background-color: rgb(255, 255, 255);
    color: rgb(15, 15, 15);
    font-weight: 700;
    transition: 0.6s;
    box-shadow: 0px 0px 60px #651f1f;
    -webkit-box-reflect: below 10px linear-gradient(to bottom, rgba(0,0,0,0.0), rgba(0,0,0,0.4));
}
.rating-container .submit:hover{
    background: rgb(43, 209, 10);
    background: linear-gradient(270deg, rgb(77, 250, 106) 0%, rgba(70, 226, 65, 0.873) 60%);
    color: rgb(255, 255, 255);
}
.rating {
    padding: 1rem;
border-radius: 42px;
background: linear-gradient(145deg, #121e66, #3b0fff);
box-shadow:  6px 6px 10px #d1d1d1,
             -6px -6px 10px #ffffff;
  display: flex;
  flex-direction: row-reverse;
  gap: 0.1rem;
  --stroke: #666;
  --fill: #ffc73a;
}

.rating input {
  appearance: unset;
}

.rating label {
  cursor: pointer;
}

.rating svg {
  width: 2rem;
  height: 2rem;
  overflow: visible;
  fill: transparent;
  stroke: var(--stroke);
  stroke-linejoin: bevel;
  stroke-dasharray: 12;
  animation: idle 4s linear infinite;
  transition: stroke 0.2s, fill 0.5s;
}

@keyframes idle {
  from {
    stroke-dashoffset: 24;
  }
}

.rating label:hover svg {
  stroke: var(--fill);
}

.rating input:checked + svg,
.rating label:has(input:checked) ~ label svg {
  transition: 0s;
  /* Hopefully firefox gets :has support soon w/o feature flag */
  animation: idle 4s linear infinite, yippee 0.75s backwards;
  fill: var(--fill);
  stroke: var(--fill);
  stroke-opacity: 0;
  stroke-dasharray: 0;
  stroke-linejoin: miter;
  stroke-width: 8px;
}

.comment{
    margin-top: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
}
.comment textarea{
    width: 80%;
    height: 10rem;
    border-radius: 20px;
    padding: 1rem;
    font-size: 1.2rem;
    color: rgb(15, 15, 15);
    outline: none;
    border: none;
    resize: none;
}

.comment-box {
    width: 100%;
    display: grid;
    place-items: center;
    margin-top: 3rem;
    background-color : #d1d1d1;
}
.comment-item {
    width: 20%;
    padding: 1rem;
    border-radius: 20px;
    margin: 1rem 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    background-color : #ffffff;
}

@keyframes yippee {
  0% {
    transform: scale(1);
    fill: var(--fill);
    fill-opacity: 0;
    stroke-opacity: 1;
    stroke: var(--stroke);
    stroke-dasharray: 10;
    stroke-width: 1px;
    stroke-linejoin: bevel;
  }

  30% {
    transform: scale(0);
    fill: var(--fill);
    fill-opacity: 0;
    stroke-opacity: 1;
    stroke: var(--stroke);
    stroke-dasharray: 10;
    stroke-width: 1px;
    stroke-linejoin: bevel;
  }

  30.1% {
    stroke: var(--fill);
    stroke-dasharray: 0;
    stroke-linejoin: miter;
    stroke-width: 8px;
  }

  60% {
    transform: scale(1.2);
    fill: var(--fill);
  }

  80% {
    transform: scale(1);
    fill: var(--fill);
  }

  100% {
    transform: scale(1);
    fill: var(--fill);
    fill-opacity: 1;
    stroke-opacity: 0;
  }
}

</style>
<body>
  <% if (message != '') { %>
    <div id="message">
    <%- message %>
    </div>
    <% } %>
  <% result.forEach(function(item) { %>
    <div class="container">
        <div class="img">
            <img src="<%= item.movies.Poster %>" alt="Movie Poster" style="border-radius: 20px;"/>
        </div>
        <div class="info">
          <h1 class="title"><%= item.movies.Title %></h1>  
            <% var test = item.movies.Genre.split(","); %>
            <h3 class="genre">Genre: <% test.forEach(function(item) { %><a href="/genre/<%= item %>"> <%= item %>, </a></a><% }); %></p>
            <% var test2 = item.movies.Actors.split(","); %>
            <p class="actors">Actors: <% test2.forEach(function(item2) { %><a href="/cast/<%= item2 %>"> <%= item2 %>, </a></a><% }); %></p>
            
            <p class="released">Released: <%= item.movies.Released %></p>
        </div>
</div>

<div class="container2">
<div class="plot">Plot: <%= item.movies.Plot %></div>
        <div class="info2">
            <p class="year">Year: <%= item.movies.Year %></p>
            <p class="director">Director: <a href="/director/<%= item.movies.Director %>"><%= item.movies.Director %></a></p>
            <p class="runtime">Runtime: <%= item.movies.Runtime %></p>
            <% var test3 = item.movies.Language.split(","); %>
            <p class="language">Language: <% test3.forEach(function(item3) { %><a href="/language/<%= item3 %>"> <%= item3 %>, </a></a><% }); %></p>
            <p class="rated">Rated: <%= item.movies.Rated %></p>
            <% var test4 = item.movies.Country.split(","); %>
            <p class="country">Country: <% test4.forEach(function(item4) { %><a href="/country/<%= item4 %>"> <%= item4 %>, </a></a><% }); %></p>
            <p class="awards">Awards: <%= item.movies.Awards %></p>
            <p class="boxoffice">Box Office: <%= item.movies.BoxOffice %></p>
            <p class="production">Production: <%= item.movies.Production %></p>
            <p class="writer">Writer: <%= item.movies.Writer %></p>
            <p class="type">Type: <%= item.movies.Type %></p>
            <p class="website">Website: <%= item.movies.Website %></p>
            <p class="imdbVotes">Votes: <%= item.movies.imdbVotes %></p>
            <p class="imdbRating">Rating: <%= Math.round( item.movies.imdbRating * 100 ) /100 %></p>
        </div>
        <div class="button" style="margin-top: 1rem;">
        <a href="https://www.imdb.com/title/<%= item.movies.imdbID %>" target="_blank" class="btn">View on IMDB </a>
        </div>

        </div>
        <div class="comment-box">
        <% if (item.Comments == undefined) { %>
            <h3>No Comments</h3>
            <% } else if (item.Comments.length > 0) { %>
            <% item.Comments.forEach(function(item) { %>
             <% if (item.verified == true) { %> 
              <div class="comment-item">
              <h3><%= item.user %></h3>
              <p><%= item.comment %></p>
              </div>
             <% } %>
            <% }); %>
            <% } else { %>
              <h3>No Comments</h3>
             <% } %>
         </div>

<% }); %>

   <form id="rating-form" action="/rating" method="POST">
    <% result.forEach(function(item) { %>
    <input type="hidden" name="movie" value="<%= item.movies.imdbID %>">
    <% }); %>
       <div class="rating-container">
        <div class="rating">
          <label for="star-10">
            <input type="radio" id="star-10" name="radio" value="10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
          </label>
          <label for="star-9">
            <input type="radio" id="star-9" name="radio" value="9">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
          </label>
          <label for="star-8">
            <input type="radio" id="star-8" name="radio" value="8">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
          </label>
          <label for="star-7">
            <input type="radio" id="star-7" name="radio" value="7">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
          </label>
          <label for="star-6">
            <input type="radio" id="star-6" name="radio" value="6">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
          </label>
            <label for="star-1">
              <input type="radio" id="star-1" name="radio" value="5">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
            </label>
            <label for="star-2">
              <input type="radio" id="star-2" name="radio" value="4">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
            </label>
            <label for="star-3">
              <input type="radio" id="star-3" name="radio" value="3">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
            </label>
            <label for="star-4">
              <input type="radio" id="star-4" name="radio" value="2">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
            </label>
            <label for="star-5">
              <input type="radio" id="star-5" name="radio" value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path pathLength="360" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg>
            </label>
          </div>
          <div class="comment">
            <textarea name="comment" id="comment" cols="30" rows="10" placeholder="Comment"></textarea>
          </div>
          <button type="submit" class="submit" onsubmit="alert()">Submit</button>
   </div>
   </form>
</body>
<script>
    const btn = document.querySelector('.btn');
    const rating = document.querySelector('.rating');
    const ratingContainer = document.querySelector('.rating-container');
    
    btn.addEventListener('click', () => {
        ratingContainer.classList.add('active');
    });
    
    submit.addEventListener('click', () => {
        ratingContainer.classList.remove('active');
    });

    //get rating value
    const stars = document.querySelectorAll('.rating input');
    const starContainer = document.querySelector('.rating');
    const output = document.querySelector('.output');

    starContainer.addEventListener('click', e => {
        const star = e.target;
        if(star.tagName === 'INPUT') {
            const val = star.value;
        }
    });

    //alert function
    function alert() {
        alert('Thank you for rating');
    }

    //disable submit button
    const submit = document.querySelector('.submit');
    submit.disabled = true;
    starContainer.addEventListener('click', e => {
        const star = e.target;
        if(star.tagName === 'INPUT') {
            submit.disabled = false;
        }
    });
    

    //send rating value to server
    const form = document.querySelector('#rating-form');
    form.addEventListener('submit', e => {
        e.preventDefault();
        const formData = new FormData(form);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/rating', true);
        xhr.onload = () => {
            if(xhr.status === 200) {
                console.log(xhr.responseText);
            }
        }
        xhr.send(formData);
    });
</script>
<%- include('layouts/footer.ejs') %>